# Battle System Overview

A logical overview of how battles work in the game.

## Battle Setup

When two parties engage in combat:
- Both parties are placed in a battle context
- All living characters from both parties participate
- Battle type determines rules (XP gain, loot drops, death consequences)
- Battle continues until one party is defeated or 200 turns pass

## Turn Order (AB Gauge System)

Characters take turns based on their Action Bar (AB) gauge:
- Each cycle, every character's AB gauge increases by a base amount (10 + their agility)
- When a character's AB gauge reaches 100, they can take their turn
- After taking a turn, their AB gauge resets to 0
- Faster characters (higher agility) reach 100 faster and act more frequently

## Turn Flow

The battle loops continuously, checking each character in turn:

### 1. Take Turn
- When a character's AB gauge reaches 100, their turn begins
- Character moves to the end of the turn queue after their turn

### 2. Check if Can Act
- Some debuffs (like Stun or Freeze) prevent the character from taking action
- If unable to act, the turn is skipped, (AB gauge set to 0 already)
- If able to act, proceed to skill selection

### 3. Pick a Skill
- The system selects an available skill from the character's skill deck.
- Characte skill deck is an array, skill position in the deck is important.
- The character will start from the first skill in the deck and then check if it's affordable:
  - Character must have enough HP, MP, SP to pay the skill's cost
  - Character must have required  *Elemantal resources*
  - Skill must not be on cooldown
  - Character must meet any buff/debuff requirements
  - Character must have required equipment equipped
- If the skill is affordable, then character will pick that skill to use in this turn.
- If the skill is not affordable, the character will move to the neck skill in the deck to do the same check.
- If no skill can be chosen, the character uses a basic attack instead

### 4. Execute Skill
- The selected skill is executed, dealing damage, applying effects, heal, etc.
- Skill cooldown is applied

### 5. Produce Resources
- After skill execution, the character may gain resources as written in the skill:
  - HP, MP, or SP regeneration
  - *Elemental resources* generated by the skill
- This is an important part of resource management during battle

### 6. End Turn

### 7. Check If Battle End
- 200 turn passed or any party all dead.


## Battle Conclusion

When the battle ends:

### Rewards & Experience
- **Winner**: Receives full experience based on enemy strength
- **Loser**: Receives half experience
- **Draw**: Both parties receive half experience
- Experience is used to train:
  - Random attributes (3 per character)
  - Skills that were used during battle
  - Weapon proficiency of equipped weapon

### Loot & Items
- If the battle type allows loot, defeated enemies drop items
- Items are distributed to winning party members
- Each character receives their share of loot

### Quest Progress
- Killing enemies in battle updates quest objectives
- Only winning party members receive quest progress

### Battle Aftermath
- All temporary effects (buffs, debuffs) are cleared
- Battle-specific stat bonuses are removed
- Health may be restored based on battle type rules
- Temporary monsters (MOBs) are removed from the world

## Key Concepts

- **AB Gauge**: Determines turn frequency - faster characters act more often
- **Skill Selection**: Characters automatically choose the best available skill they can afford
- **Elemental Resource Management**: Skills consume Elemental Resource and may produce some back. Elemental resources consist of 7 type Neutral, Order, Chaos, Fire, Earth, Water, and Wind. This makes the Deck building and skill position important, For example, if the first card in the deck is a card that consume nothing at all, when character pick a skill card, it will always pick the first card, making it that the other card in the deck rendered impossible to be chosen. The strength of a card can be implied from how much Elemental Resource it consume.
- **Battle Types**: Different battle types have different rules for XP, loot, and death
- **Turn-Based Combat**: Each character acts when their gauge fills, creating dynamic turn order

